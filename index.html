<!DOCTYPE html>
<html>
  <head>
    <title>GitHub</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body
    style="
      background: url('./assets/octcat.jpg');
      background-repeat: no-repeat;
      background-size: cover;
    "
  >
    <script>
      // Get id from user and send request to Github
      function get_id() {
        var id = document.getElementById("id").value;
        fetch("https://api.github.com/users/" + id)
          .then((response) => {
            return response.json();
          })
          .then((myJson) => {
            var name = myJson.name;
            var image = myJson.avatar_url;
            var blog = myJson.blog;
            var bio = myJson.bio;
            var location = myJson.location;

            if (name != '') {
              document.getElementById("name").innerHTML = name;
              document.getElementById("name").style.display = "flex";
            }
            if (blog != '') {
              console.log(blog)
              document.getElementById("blog").href = blog;
              document.getElementById("blog").innerHTML = blog;
              document.getElementById("blogid").style.display = "flex";
            }
            if (bio != '') {
              document.getElementById("bio").innerHTML = bio;
              document.getElementById("bioid").style.display = "flex";
            }
            if (location != '') {
              document.getElementById("location").innerHTML = location;
              document.getElementById("locid").style.display = "flex";
            }

            document.getElementById("image").src = image;
          });

        fetch("https://api.github.com/users/" + id + "/repos")
          .then((response) => {
            return response.json();
          })
          .then((myJson) => {
            var arr = [];
            for (repo in myJson) {
              arr.push([myJson[repo]["pushed_at"], myJson[repo]["language"]]);
            }
            arr.sort().reverse();
            var langs = {};
            var num = 0;
            for (key in arr) {
              if (num < 5) {
                if (arr[key][1] != null) {
                  num += 1;
                  if (arr[key][1] in langs) {
                    number = langs[arr[key][1]];
                    langs[arr[key][1]] = number + 1;
                  } else {
                    langs[arr[key][1]] = 1;
                  }
                }
              }
            }
            let list = document.getElementById("myList");
            list.innerHTML = "";
            let list_star = document.getElementById("grade");
            list_star.innerHTML = "";

            for (item in langs) {
              let li = document.createElement("li");
              li.innerText = item;
              list.appendChild(li);

              let lis = document.createElement("li");
              var star = "";
              for (i = 0; i < langs[item]; i++) {
                star += "*";
              }
              lis.innerText = star;
              list_star.appendChild(lis);
            }
            document.getElementById("results").style.visibility = "visible";
          });
      }
    </script>

    <div class="main">
      <div id="results" class="results">
        <div style="display: flex; flex-direction: row; max-width: fit-content">
          <!--Image-->
          <img id="image" class="image" src="./assets/profile.png" />

          <div class="text">
            <!--Name-->
            <h2 style="display: flex;" id="name"></h2>

            <!--Blog-->
            <div id = 'blogid'
              style="
                display: none;
                flex-direction: row;
                margin-bottom: 20px;
                width: 50%;
                display: none;
              "
            >
              <img
                src="./assets/link.png"
                style="
                  width: 20px;
                  height: 20px;
                  margin-right: 10px;
                  margin-bottom: 0px;
                "
              />
              <a style="margin-top: -5px; width: 50%" id="blog"></a>
            </div>

            <!--Location-->
            <div id = 'locid' style="display: none; flex-direction: row;">
              <img
                src="./assets/location.png"
                style="
                  width: 20px;
                  height: 20px;
                  margin-right: 10px;
                  margin-bottom: 0px;
                "
              />
              <p style="margin-top: -5px" id="location"></p>
            </div>
            <!--Languages-->
            <div class="languages">
              <h4 style="margin-bottom: 5px; color: #f29e21">Languages</h4>
              <div style="display: flex; flex-direction: row">
                <ul
                  style="margin-right: 20px; margin-top: 15px"
                  id="myList"
                ></ul>
                <ul class="stars" id="grade"></ul>
              </div>
            </div>
          </div>
        </div>

        <!--Bio-->
        <div id = 'bioid'
          style="
            flex-direction: row;
            margin-top: 20px;
            margin-left: 5px;
            margin-right: 10px;
            width: fit-content;
            display: none;
          "
        >
          <img
            src="./assets/bio.png"
            style="
              width: 25px;
              height: 25px;
              margin-right: 10px;
              margin-bottom: 0px;
              opacity: 0.7;
            "
          />
          <p style="margin-top: 2px; max-width: 40vw" id="bio"></p>
        </div>
      </div>

      <!--Get ID-->
      <div class="id-get">
        <h1>Give me ID!</h1>
        <input class="input" type="text" id="id" />
        <button class="button" onclick="get_id()">Let's Go!</button>
      </div>
    </div>
  </body>
</html>
